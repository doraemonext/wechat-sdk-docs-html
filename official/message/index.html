<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://wechat-python-sdk.com/official/message/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>2. 消息管理 - wechat-python-sdk</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <link href="../../css/base.css" rel="stylesheet">
        <link href="../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">wechat-python-sdk</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">首页</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">快速上手 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../quickstart/intro/">1. SDK 快速介绍</a>
</li>

                    
                        
<li >
    <a href="../../quickstart/official/">2. 官方接口</a>
</li>

                    
                        
<li >
    <a href="../../quickstart/wechatconf/">3. WechatConf 详解</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">官方接口 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../intro/">0. 前置介绍</a>
</li>

                    
                        
<li >
    <a href="../access/">1. 接入指南</a>
</li>

                    
                        
<li class="active">
    <a href="./">2. 消息管理</a>
</li>

                    
                        
<li >
    <a href="../menu/">3. 自定义菜单</a>
</li>

                    
                        
<li >
    <a href="../website/">4. 微信网页开发</a>
</li>

                    
                        
<li >
    <a href="../material/">5. 素材管理</a>
</li>

                    
                        
<li >
    <a href="../user/">6. 用户管理</a>
</li>

                    
                        
<li >
    <a href="../account/">7. 账号管理</a>
</li>

                    
                        
<li >
    <a href="../datacube/">8. 数据统计</a>
</li>

                    
                        
<li >
    <a href="../store/">9. 微信小店 </a>
</li>

                    
                        
<li >
    <a href="../service/">10. 微信多客服功能</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">API 文档 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="../../api/wechatconf/">1. WechatConf</a>
</li>

                    
                        
<li >
    <a href="../../api/wechatmessage/">2. WechatMessage</a>
</li>

                    
                        
<li >
    <a href="../../api/exception/">3. 异常类</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../faq/">FAQ</a>
                </li>
            
            
            
                <li >
                    <a href="../../about/project/">关于项目</a>
                </li>
            
            
            
                <li >
                    <a href="../../about/author/">关于作者</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../access/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../menu/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/wechat-python-sdk">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#-">官方接口 - 消息管理</a></li>
        
            <li><a href="#xml">解析接收到的 XML 消息</a></li>
        
            <li><a href="#_1">获取解析后的信息</a></li>
        
            <li><a href="#-_1">被动回复消息 - 文本消息</a></li>
        
            <li><a href="#-_2">被动回复消息 - 图片消息</a></li>
        
            <li><a href="#-_3">被动回复消息 - 语音消息</a></li>
        
            <li><a href="#-_4">被动回复消息 - 视频消息</a></li>
        
            <li><a href="#-_5">被动回复消息 - 音乐消息</a></li>
        
            <li><a href="#-_6">被动回复消息 - 图文消息</a></li>
        
            <li><a href="#-_7">被动回复消息 - 空消息</a></li>
        
            <li><a href="#_4">客服消息</a></li>
        
            <li><a href="#_12">群发接口</a></li>
        
            <li><a href="#_13">模板消息</a></li>
        
            <li><a href="#_20">公众号自动回复配置</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="-">官方接口 - 消息管理<a class="headerlink" href="#-" title="Permanent link">&para;</a></h1>
<h2 id="xml">解析接收到的 XML 消息<a class="headerlink" href="#xml" title="Permanent link">&para;</a></h2>
<p><strong>调用方法：</strong><code>.parse_data(data, msg_signature=None, timestamp=None, nonce=None)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>data</code>: 需要解析的 XML 字符串数据</li>
<li><code>msg_signature</code>: 消息解密专用 - 签名</li>
<li><code>timestamp</code>: 消息解密专用 - 时间戳</li>
<li><code>nonce</code>: 消息解密专用 - 随机数</li>
</ul>
<p><strong>调用前检查：</strong>Token</p>
<p><strong>返回值：</strong><code>None</code></p>
<p><strong>异常：</strong>当解析 XML 失败时抛出 <a href="../../api/exception/#parseerror"><code>exceptions.ParseError</code></a> 异常。</p>
<p><strong>说明：</strong>如果在实例化 WechatConf 时传入了 <code>encrypt_mode='safe'</code>，那么在调用本方法进行解析消息时必须传入 <code>msg_signature</code> / <code>timestamp</code> / <code>nonce</code> 三个参数，否则会无法解密消息。</p>
<p>如果 <code>encrypt_mode='normal'</code> 或 <code>encrypt_mode='compatible'</code>，则无需传入后面三个参数。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/17/f298879f8fb29ab98b2f2971d42552fd.html">接收普通消息</a> / <a href="http://mp.weixin.qq.com/wiki/7/9f89d962eba4c5924ed95b513ba69d9b.html">接收事件推送</a></p>
<h2 id="_1">获取解析后的信息<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>当调用 <a href="#xml"><code>.parse_data()</code></a> 方法解析成功后，你可以直接获取解析后的具体信息：</p>
<h3 id="_2">公共信息获取<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<pre><code class="python">id = wechat.message.id          # 对应于 XML 中的 MsgId
target = wechat.message.target  # 对应于 XML 中的 ToUserName
source = wechat.message.source  # 对应于 XML 中的 FromUserName
time = wechat.message.time      # 对应于 XML 中的 CreateTime
type = wechat.message.type      # 对应于 XML 中的 MsgType
raw = wechat.message.raw        # 原始 XML 文本，方便进行其他分析
</code></pre>

<h3 id="_3">私有信息获取<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>当 <code>isinstance(wechat.message, TextMessage)</code> 时，有：</p>
<pre><code class="python">content = wechat.message.content                   # 对应于 XML 中的 Content
</code></pre>

<p>当 <code>isinstance(wechat.message, ImageMessage)</code> 时，有：</p>
<pre><code class="python">picurl = wechat.message.picurl                     # 对应于 XML 中的 PicUrl
media_id = wechat.message.media_id                 # 对应于 XML 中的 MediaId
</code></pre>

<p>当 <code>isinstance(wechat.message, VoiceMessage)</code> 时，有：</p>
<pre><code class="python">media_id = wechat.message.media_id                 # 对应于 XML 中的 MediaId
format = wechat.message.format                     # 对应于 XML 中的 Format
recognition = wechat.message.recognition           # 对应于 XML 中的 Recognition
</code></pre>

<p>当 <code>isintance(wechat.message, VideoMessage)</code> 或 <code>isinstance(wechat.message, ShortVideoMessage)</code> 时，有：</p>
<pre><code class="python">media_id = wechat.message.media_id                 # 对应于 XML 中的 MediaId
thumb_media_id = wechat.message.thumb_media_id     # 对应于 XML 中的 ThumbMediaId
</code></pre>

<p>当 <code>isinstance(wechat.message, LocationMessage)</code> 时，有：</p>
<pre><code class="python">location = wechat.message.location                 # Tuple(X, Y)，对应于 XML 中的 (Location_X, Location_Y)
scale = wechat.message.scale                       # 对应于 XML 中的 Scale
label = wechat.message.label                       # 对应于 XML 中的 Label
</code></pre>

<p>当 <code>isinstance(wechat.message, LinkMessage)</code> 时，有：</p>
<pre><code class="python">title = wechat.message.title                       # 对应于 XML 中的 Title
description = wechat.message.description           # 对应于 XML 中的 Description
url = wechat.message.url                           # 对应于 XML 中的 Url
</code></pre>

<p>当 <code>isinstance(wechat.message, EventMessage)</code> 时，有：</p>
<pre><code class="python">if wechat.message.type == 'subscribe':  # 关注事件(包括普通关注事件和扫描二维码造成的关注事件)
    key = wechat.message.key                        # 对应于 XML 中的 EventKey (普通关注事件时此值为 None)
    ticket = wechat.message.ticket                  # 对应于 XML 中的 Ticket (普通关注事件时此值为 None)
elif wechat.message.type == 'unsubscribe':  # 取消关注事件（无可用私有信息）
    pass
elif wechat.message.type == 'scan':  # 用户已关注时的二维码扫描事件
    key = wechat.message.key                        # 对应于 XML 中的 EventKey
    ticket = wechat.message.ticket                  # 对应于 XML 中的 Ticket
elif wechat.message.type == 'location':  # 上报地理位置事件
    latitude = wechat.message.latitude              # 对应于 XML 中的 Latitude
    longitude = wechat.message.longitude            # 对应于 XML 中的 Longitude
    precision = wechat.message.precision            # 对应于 XML 中的 Precision
elif wechat.message.type == 'click':  # 自定义菜单点击事件
    key = wechat.message.key                        # 对应于 XML 中的 EventKey
elif wechat.message.type == 'view':  # 自定义菜单跳转链接事件
    key = wechat.message.key                        # 对应于 XML 中的 EventKey
elif wechat.message.type == 'templatesendjobfinish':  # 模板消息事件
    status = wechat.message.status                  # 对应于 XML 中的 Status
elif wechat.message.type in ['scancode_push', 'scancode_waitmsg', 'pic_sysphoto', 
                             'pic_photo_or_album', 'pic_weixin', 'location_select']:  # 其他事件
    key = wechat.message.key                        # 对应于 XML 中的 EventKey
</code></pre>

<h2 id="-_1">被动回复消息 - 文本消息<a class="headerlink" href="#-_1" title="Permanent link">&para;</a></h2>
<p>将文字信息组装为符合微信服务器要求的响应数据</p>
<p><strong>调用方法：</strong><code>.response_text(content, escape=False)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>content</code>: 回复文字</li>
<li><code>escape</code>: 是否转义该文本内容 (默认不转义)</li>
</ul>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>说明：</strong>该方法会根据 WechatConf 实例化时的 <code>encrypt_mode</code> 参数自动组装普通消息或加密消息，无需干预。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html#.E5.9B.9E.E5.A4.8D.E6.96.87.E6.9C.AC.E6.B6.88.E6.81.AF">回复文本消息</a></p>
<h2 id="-_2">被动回复消息 - 图片消息<a class="headerlink" href="#-_2" title="Permanent link">&para;</a></h2>
<p>将 media_id 所代表的图片组装为符合微信服务器要求的响应数据</p>
<p><strong>调用方法：</strong><code>.response_image(media_id)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>media_id</code>: 图片的 Media ID</li>
</ul>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>说明：</strong>该方法会根据 WechatConf 实例化时的 <code>encrypt_mode</code> 参数自动组装普通消息或加密消息，无需干预。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html#.E5.9B.9E.E5.A4.8D.E5.9B.BE.E7.89.87.E6.B6.88.E6.81.AF">回复图片消息</a></p>
<h2 id="-_3">被动回复消息 - 语音消息<a class="headerlink" href="#-_3" title="Permanent link">&para;</a></h2>
<p>将 media_id 所代表的语音组装为符合微信服务器要求的响应数据</p>
<p><strong>调用方法：</strong><code>.response_voice(media_id)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>media_id</code>: 语音的 Media ID</li>
</ul>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>说明：</strong>该方法会根据 WechatConf 实例化时的 <code>encrypt_mode</code> 参数自动组装普通消息或加密消息，无需干预。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html#.E5.9B.9E.E5.A4.8D.E8.AF.AD.E9.9F.B3.E6.B6.88.E6.81.AF">回复语音消息</a></p>
<h2 id="-_4">被动回复消息 - 视频消息<a class="headerlink" href="#-_4" title="Permanent link">&para;</a></h2>
<p>将 media_id 所代表的视频组装为符合微信服务器要求的响应数据</p>
<p><strong>调用方法：</strong><code>.response_video(media_id, title=None, description=None)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>media_id</code>: 视频的 Media ID</li>
<li><code>title</code>: 视频消息的标题</li>
<li><code>description</code>: 视频消息的描述</li>
</ul>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>说明：</strong>该方法会根据 WechatConf 实例化时的 <code>encrypt_mode</code> 参数自动组装普通消息或加密消息，无需干预。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html#.E5.9B.9E.E5.A4.8D.E8.A7.86.E9.A2.91.E6.B6.88.E6.81.AF">回复视频消息</a></p>
<h2 id="-_5">被动回复消息 - 音乐消息<a class="headerlink" href="#-_5" title="Permanent link">&para;</a></h2>
<p>将音乐信息组装为符合微信服务器要求的响应数据</p>
<p><strong>调用方法：</strong><code>.response_music(music_url, title=None, description=None, hq_music_url=None, thumb_media_id=None)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>music_url</code>: 音乐链接</li>
<li><code>title</code>: 音乐标题</li>
<li><code>description</code>: 音乐描述</li>
<li><code>hq_music_url</code>: 高质量音乐链接, WIFI环境优先使用该链接播放音乐</li>
<li><code>thumb_media_id</code>: 缩略图的 MediaID</li>
</ul>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>说明：</strong>该方法会根据 WechatConf 实例化时的 <code>encrypt_mode</code> 参数自动组装普通消息或加密消息，无需干预。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html#.E5.9B.9E.E5.A4.8D.E9.9F.B3.E4.B9.90.E6.B6.88.E6.81.AF">回复音乐消息</a></p>
<h2 id="-_6">被动回复消息 - 图文消息<a class="headerlink" href="#-_6" title="Permanent link">&para;</a></h2>
<p>将图文信息组装为符合微信服务器要求的响应数据</p>
<p><strong>调用方法：</strong><code>.response_news(articles)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>articles</code>: list 对象, 每个元素为一个 dict 对象, key 包含 <code>title</code>, <code>description</code>, <code>picurl</code>, <code>url</code>，示例如下：<pre><code>[{
    'title': u'第一条新闻标题',
    'description': u'第一条新闻描述，这条新闻没有预览图',
    'url': u'http://www.google.com.hk/',
}, {
    'title': u'第二条新闻标题, 这条新闻无描述',
    'picurl': u'http://doraemonext.oss-cn-hangzhou.aliyuncs.com/test/wechat-test.jpg',
    'url': u'http://www.github.com/',
}, {
    'title': u'第三条新闻标题',
    'description': u'第三条新闻描述',
    'picurl': u'http://doraemonext.oss-cn-hangzhou.aliyuncs.com/test/wechat-test.jpg',
    'url': u'http://www.v2ex.com/',
}]
</code></pre>
</li>
</ul>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>说明：</strong>该方法会根据 WechatConf 实例化时的 <code>encrypt_mode</code> 参数自动组装普通消息或加密消息，无需干预。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html#.E5.9B.9E.E5.A4.8D.E5.9B.BE.E6.96.87.E6.B6.88.E6.81.AF">回复图文消息</a></p>
<h2 id="-_7">被动回复消息 - 空消息<a class="headerlink" href="#-_7" title="Permanent link">&para;</a></h2>
<p>假如服务器无法保证在五秒内处理并回复，必须调用该接口，这样微信服务器才不会对此作任何处理，并且不会发起重试（这种情况下，可以使用客服消息接口进行异步回复），否则，将出现严重的错误提示。</p>
<p><strong>调用方法：</strong><code>.response_none()</code></p>
<p><strong>调用前检查：</strong>必须已经成功调用过 <a href="#xml"><code>.parse_data()</code></a> 方法。</p>
<p><strong>返回值：</strong>组装好的 XML 字符串，可直接回复微信服务器。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/1/6239b44c206cab9145b1d52c67e6c551.html">回复空消息</a></p>
<h2 id="_4">客服消息<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="_5">发送文本消息<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_text_message(user_id, content)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>content</code>: 消息正文</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，发送失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/11/c88c270ae8935291626538f9c64bd123.html">客服接口</a></p>
<h3 id="_6">发送图片消息<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_image_message(user_id, media_id)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>media_id</code>: 图片的 Media ID，可通过 <code>.upload_media()</code> 方法上传</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，发送失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/11/c88c270ae8935291626538f9c64bd123.html">客服接口</a></p>
<h3 id="_7">发送语音消息<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_voice_message(user_id, media_id)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>media_id</code>: 语音的 Media ID，可通过 <code>.upload_media()</code> 方法上传</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，发送失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/11/c88c270ae8935291626538f9c64bd123.html">客服接口</a></p>
<h3 id="_8">发送视频消息<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_video_message(user_id, media_id, title=None, description=None)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>media_id</code>: 视频的 Media ID，可通过 <code>.upload_media()</code> 方法上传</li>
<li><code>title</code>: 视频消息的标题</li>
<li><code>description</code>: 视频消息的描述</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，发送失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/11/c88c270ae8935291626538f9c64bd123.html">客服接口</a></p>
<h3 id="_9">发送音乐消息<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_music_message(user_id, url, hq_url, thumb_media_id, title=None, description=None)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>url</code>: 音乐链接</li>
<li><code>hq_url</code>: 高品质音乐链接，wifi环境优先使用该链接播放音乐</li>
<li><code>thumb_media_id</code>: 缩略图的 Media ID，可以通过 <code>.upload_media()</code> 方法上传</li>
<li><code>title</code>: 音乐标题</li>
<li><code>description</code>: 音乐描述</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，发送失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/11/c88c270ae8935291626538f9c64bd123.html">客服接口</a></p>
<h3 id="_10">发送图文消息<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_article_message(self, user_id, articles=None, media_id=None)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>articles</code>: list 对象, 每个元素为一个 dict 对象, key 包含 <code>title</code>, <code>description</code>, <code>picurl</code>, <code>url</code> （示例同 <a href="#-_6">被动回复消息 - 图文消息</a>）</li>
<li><code>media_id</code>: 待发送的图文 Media ID</li>
</ul>
<p>注意 <code>articles</code> 和 <code>media_id</code> 参数只能传递任意一个。同时传递两个将优先使用 <code>articles</code> 进行发送。</p>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，发送失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/11/c88c270ae8935291626538f9c64bd123.html">客服接口</a></p>
<h3 id="_11">发送卡券<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>待开发</p>
<h2 id="_12">群发接口<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<p>待开发</p>
<h2 id="_13">模板消息<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<h3 id="_14">设置所属行业<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.set_template_industry(industry_id1, industry_id2)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>industry_id1</code>: 主营行业代码</li>
<li><code>industry_id2</code>: 副营行业代码</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据：<code>{"errcode": 0, "errmsg": "ok"}</code>，一般无需理会该返回值，设置失败会抛出异常，捕获异常即可。</p>
<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/5/6dde9eaa909f83354e0094dc3ad99e05.html#.E8.AE.BE.E7.BD.AE.E6.89.80.E5.B1.9E.E8.A1.8C.E4.B8.9A">设置所属行业</a></p>
<h3 id="_15">获取设置的行业信息<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>待开发</p>
<h3 id="id">获得模板 ID<a class="headerlink" href="#id" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.get_template_id(template_id_short)</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>template_id_short</code>: 模板库中模板的编号，有“TM**”和“OPENTMTM**”等形式</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据，示例：</p>
<pre><code class="json">{
    &quot;errcode&quot;: 0,
    &quot;errmsg&quot;: &quot;ok&quot;,
    &quot;template_id&quot;: &quot;Doclyl5uP7Aciu-qZ7mJNPtWkbkYnWBWVja26EGbNyk&quot;
}
</code></pre>

<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/5/6dde9eaa909f83354e0094dc3ad99e05.html#.E8.8E.B7.E5.BE.97.E6.A8.A1.E6.9D.BFID">获得模板ID</a></p>
<h3 id="_16">获取模板列表<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>待开发</p>
<h3 id="_17">删除模板<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>待开发</p>
<h3 id="_18">发送模板消息<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p><strong>调用方法：</strong><code>.send_template_message(user_id, template_id, data, url='', topcolor='#FF0000')</code></p>
<p><strong>参数说明：</strong></p>
<ul>
<li><code>user_id</code>: 用户 ID（OpenID）</li>
<li><code>template_id</code>: 模板ID</li>
<li>
<p><code>data</code>: 模板消息数据 (dict形式)，示例如下：</p>
<pre><code>{
    "first": {
        "value": "恭喜你购买成功！",
        "color": "#173177"
    },
    "keyword1":{
        "value": "巧克力",
        "color": "#173177"
    },
    "keyword2": {
        "value": "39.8元",
        "color": "#173177"
    },
    "keyword3": {
        "value": "2014年9月16日",
        "color": "#173177"
    },
    "remark":{
        "value": "欢迎再次购买！",
        "color": "#173177"
    }
}
</code></pre>
</li>
<li>
<p><code>url</code>: 跳转地址 (默认为空)</p>
</li>
<li><code>topcolor</code>: 顶部颜色RGB值 (默认 '#FF0000')</li>
</ul>
<p><strong>调用前检查：</strong>App ID / App Secret</p>
<p><strong>返回值：</strong>正常返回官方接口的 JSON 数据，示例：</p>
<pre><code class="json">{
    &quot;errcode&quot;: 0,
    &quot;errmsg&quot;: &quot;ok&quot;,
    &quot;msgid&quot;: 200228332
}
</code></pre>

<p><strong>异常：</strong>当发生失败时抛出 <a href="../../api/exception/#officialapierror"><code>exceptions.OfficialAPIError</code></a> 异常，该异常包含了错误的代号与原因信息。</p>
<p><strong>对应官方文档：</strong><a href="http://mp.weixin.qq.com/wiki/5/6dde9eaa909f83354e0094dc3ad99e05.html#.E5.8F.91.E9.80.81.E6.A8.A1.E6.9D.BF.E6.B6.88.E6.81.AF">发送模板消息</a></p>
<h3 id="_19">模板消息事件推送<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>当模板消息事件推送 XML 到达并经过 <a href="#xml"><code>.parse_data()</code></a> 解析后，你可以通过下面的方式获取状态信息。</p>
<p>首先要确定该消息是模板消息的事件推送：</p>
<pre><code class="python">from wechat_sdk.messages import EventMessage
if isinstance(wechat.message, EventMessage) and wechat.message.type == 'templatesendjobfinish':
</code></pre>

<p>然后就可以根据 <code>wechat.message.status</code> 的情况进行判断了：</p>
<ol>
<li>当送达成功时，<code>wechat.message.status == 'success'</code></li>
<li>当送达失败，原因为用户拒收（用户设置拒绝接收公众号消息）时，<code>wechat.message.status == 'failed:user block'</code></li>
<li>当送达失败，其他原因时，<code>wechat.message.status == 'failed:system failed'</code></li>
</ol>
<h2 id="_20">公众号自动回复配置<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<p>待开发</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center>Copyright 2014-2016 Ace Kwok</center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>